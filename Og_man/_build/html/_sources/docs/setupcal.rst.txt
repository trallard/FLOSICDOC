.. _setup:

==============================
Quick start guide to running a FLOSIC calculation
==============================


Basic input files for FLOSIC are called "CLUSTER" and "FRMORB".  
The files requires minimal input from the user and most parameters required from the calculations are obtained 
using default values. You can specify some parameters that control the calculations in the file called "NRLMOL_INPUT.DAT". This file is 
optional, in that, if it  doesn't exist it will be created automatically with default choices. We will discuss the details of the 
parameters in the **NRLMOL_INPUT.DAT** later. 

For now let's work on setting up of the **CLUSTER** file. It is the minimal input needed to run the FLOSIC code.

An example CLUSTER file is shown below for the LiH molecule. The format is describe in more detail in tutorial 1.

GGA-PBE*GGA-PBE          (DF TYPE EXCHANGE*CORRELATION)
NONE                     (TD, OH, IH, X, Y, XY, ... OR GRP)
2                        (NUMBER OF INEQUIV. ATOMS IN CH4)
0.0000  0.0000  0.0000 3 ALL
0.0000  0.0000  3.0139 1 ALL
0.0 0.0                  (NET CHARGE AND NET SPIN)
 --------------OR-------------------
@XMOL.DAT
 IF YOU WISH TO START FROM AN XYZ XMOL FILE


You can set up **CLUSTER** file in number of different ways. 

  #. You can cut and paste it from these pages, or execute FLOSIC in an empty directory, and adapt the file by  hand using the editor of your choice.

  #. You can use a script called **xmol-dat_2_CLUSTER.pl**  to create it from the **XMOL.DAT**. The **XMOL.DAT**
     is a file in the *xyz* format and has atomic numbers in the place of the atomic labels (symbols). To convert standard
     **xmol2xyz.pl**.  This way of creating **CLUSTER** will not make use of point group symmetry. If the molecules or 
     your system has symmetry it is advisable to make use of point group symmetry as it results in significant computational
     savings. To use symmetry, use the following approach. Also, ensure that your spin (moment) is correctly specified.
     The script will set it to 1 for odd electron systems and to 0 for an even electron system.  You may want to adapt
     *charge* and *spin* to your needs.

  #. Let's suppose your systems of interest is in "XMOL.DAT", then execute the following command  
     **echo "@XMOL.DAT" > CLUSTER**

     This will insert a line "@XMOL.DAT" in the CLUSTER file. Now execute the FLOSIC code on the command line. FLOSIC 
     will try to identify the available symmetry. It will find the symmetry operations and write them in the file called
     **GRPMAT** and it will create the **CLUSTER** file. The CLUSTER file created will have fewer atoms (only inequivalent atoms
     are listed). The entire structure can be generated using the symmetry operations and the positions of the ineqivalent
     atoms. Note that often for the systems containing high symmetry (e.g, *icosahedral* ), FLOSIC will usually find lower
     point group symmetry.  To overcome this you can use you can combine step 1 and step 3. It is advisable to ensure that 
     the resultant XMOL.xyz or XMOL.DAT generated during the calculations is the system of your interest.

  #.  Use the **NRLMOL GUI**. NRLMOL GUI allows setting up of CLUSTER file and visualization of results produced 
      by the NRLMOL. For the visulalizatin of results like DOS, it also requires the *gnuplot* software to be installed.

To run a FLOSIC calculation, a FRMORB file is required, which contains positions for FODs. An example FRMORB file for LiH is below:

 2 2
0.000 0.000 0.000
0.000 0.000 2.500
0.000 0.000 0.000
0.000 0.000 2.500

The first line states how many up spin FODs, and how many down spin FODs are used in the calculation. There are 2 up FODs, so the next 2 lines (lines 2-3)
contain x, y, & z coordinates for up spin FODs. There are also 2 down FODs, so the last 2 coordinates are for down spin FODs (lines 4-5).

To create FRMORB files, you can place FODs by hand, or use an FOD generator (such as the fodMC) to create starting FODs.

Before starting a FLOSIC calculation, make sure that SETUPCALCV option in the NRLMOL_INPUT.DAT file is set to 'SCF-ONLY' instead of 'LBFGS'. 
This ensures that atomic geometries will not be updated, which is recommended for optimizing FODs during FLOSIC calculations .

Try running the code using the example CLUSTER and FRMORB files. The final energy (EDFT+SIC) in the SUMMARY file after one SCF cycle should be **-8.052832898** Hartree.

You'll notice the FOD positions in FRMORB have been moved, as they are being optimized, similar to an atomic geometry optimization at the DFT level. 
Previous FOD geometries are contained in the records file, along with FOD forces.




