.. _setupexc:

===============================================================================
 Setting up perturbative Delta SCF calculation with previous versions of NRLMOL
===============================================================================

Running excited state calculations using perturbative delta SCF method. 
This is not automated yet so use the following guidelines to run the excited states calculations. The method works well 
for the charge transfer excited states.
It is a perturbation approach, so the first step is to carry out the ground state SCF. 
Run a spin-polarized ground state calculation for a chosen system without using any 
point group symmetry.  
Each excited state calculation is done in a separate directory.  
Use the following procedure to run the excited state calculations.

   #. Make a directory, say *EXCITED1* and copy the following files from the directory where the  ground state calculations were performed to the excited state directory:
      SYMBOL,  GRPMAT, ISYMGEN, HAMOLD, REPMAT, VMOLD. 

   #. Create RUNS file.  
      Your RUNS file for the excited state calculation should be:

      .. literalinclude:: input_files/runs_excited.file

      where, *N* is the geometry number of the corresponding geometry in **SYMBOL**. "-1" option allows previously generated mesh;
      if, for some reason, this does not work, then set it to "1" and rerun. **WARNING** Most of the problems/errors with excited
      states calculation are due to use of different geometries in the excited state and the ground state. So please ensure that 
      you use correct geometry:- the second field in the top line of the **RUNS** file.
      Also, for the excited state calculation with perturbative delta SCF method, you always start with Hamiltonian.

   #. Run the command  "\$  echo ".TRUE." > RUNTYPE 
    
   #. Next create a file called **OCCEXC** with required occupation numbers. (No blank lines). 
      An example *OCCEXC* for the water molecule (H2O) is given below:

      .. literalinclude:: input_files/h2o_occexc.file

   #. Compile the NRLMOL for the excited states. Your executable for the ground state may not work as the parameters
      are different for the excited states. When compiled, copy the executable here and submit the job. 

**TIP** The memory demand for the excited state calculation is much larger than the ground state as both the ground 
      and excited state Hamiltonians are required. If your calculations run out of memory, one possibility is to use fewer cores 
      per node in a parallel job. 

